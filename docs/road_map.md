# 개발 로드맵

본 문서는 Windows 전용 애니메이션 파일 정리 애플리케이션 개발을 위한 상세 로드맵입니다. 제공된 개발 계획서(`docs/develop_report.md`)를 기반으로 주요 개발 단계와 목표를 정의합니다.

## 연간 개발 진행 계획표

각 개발 페이즈는 다음과 같은 연간 일정으로 진행될 예정입니다. 시간적 여유를 가지고 각 단계별 목표 달성에 집중합니다.

| 개발 페이즈                                    | 예상 기간         | 주요 활동 내용                                                                                                                               |
| :--------------------------------------------- | :---------------- | :------------------------------------------------------------------------------------------------------------------------------------------- |
| **Phase 1: 개발 목표 및 기반 환경 설정**         | 1년차 1~2분기     | 시스템 구성 설계, 핵심 기술 스택 선정 및 환경 설정, 기본 프로젝트 구조 확립                                                                     |
| **Phase 2: 핵심 기능 구현 - 파일 식별 및 기본 메타데이터 수집** | 1년차 3분기 ~ 2년차 2분기 | 파일 해시 기반 식별 모듈 구현 (AniDB 연동 포함), 로컬 DB 스키마 설계 및 구현, 기본 메타데이터 수집 및 캐싱 로직 구현                               |
| **Phase 3: 기능 확장 - 다양한 메타데이터 연동 및 파일 정리** | 2년차 3분기 ~ 3년차 2분기 | 다양한 메타데이터 API 플러그인 연동 (TMDB, MAL/Jikan, AniList 등), 메타데이터 통합 및 충돌 처리, 사용자 설정 파일 정리 로직 구현, 관련 파일 처리 |
| **Phase 4: 사용자 편의 기능 및 확장성 확보**         | 3년차 3분기 ~ 4년차 1분기 | 미디어 플레이어 연동 및 시청 기록 관리, 시청 기록 통계/분석, 즐겨찾기/추천 시스템 연동, 플러그인 구조 강화 및 관리                             |
| **Phase 5: 품질 보증 및 배포**                | 4년차 2분기 ~ 4년차 4분기 | 단위/통합/GUI/성능 테스트 실행, 사용자 인수 테스트(UAT), 최종 배포 준비 (PyInstaller 등), 사용자 가이드 작성, 유지보수 계획 수립                 |

*위 일정은 예상이며, 실제 진행 상황에 따라 유연하게 조정될 수 있습니다.*

## 1. 개발 목표 및 기반 환경 설정 (Phase 1)

이 단계에서는 프로젝트의 기반을 다지고 핵심 환경을 설정합니다.

### 목표

- Windows 전용 독립 실행형 애니메이션 파일 정리 애플리케이션 개발.
- 파일 자동 정리 (연도 → 분기 → 시리즈명 → 에피소드 구조).
- 외부 메타데이터 API 연동 (AniDB, TMDB 등).
- 오프라인 메타데이터 저장 및 활용.
- 미디어 플레이어 연동 및 시청 기록 관리.
- 추천 기능 구현.

### 시스템 구성 설계

- GUI 클라이언트 형태.
- 내부 모듈: 파일 식별/정리, 메타데이터 수집 플러그인, 데이터베이스, 미디어 플레이어 연동.
- 사용자 인터페이스(GUI)를 통한 폴더 선택 및 옵션 지정.
- 코어 로직: 파일 스캔, 해시 계산, 정보 추출.
- 파일 시스템 감시 모듈(Watchdog)을 통한 자동 정리 트리거.

### 핵심 기술 스택 선정 및 환경 설정

- **주 언어**: Python (성능/GUI 요구에 따라 C# WPF 등 대안 고려).
- **GUI 프레임워크**: PySide6 (Qt for Python) 우선 검토.
- **데이터베이스**: SQLite (로컬 내장 DB).
- **ORM**: SQLAlchemy.
- **HTTP 클라이언트**: Requests.
- **파일 시스템 모니터링**: Watchdog.
- **해시 연산**: `hashlib` (MD4), `concurrent.futures`, 필요 시 C 라이브러리 활용.
- **미디어 플레이어 연동**: `python-vlc`, `python-mpv` 등.
- **기타**: `json`, `datetime`, `pytz`, `logging`, `threading`/`QThread`.
- **개발 환경 설정**: 필요한 라이브러리 설치, 기본 프로젝트 구조 설정.

## 2. 핵심 기능 구현 - 파일 식별 및 기본 메타데이터 수집 (Phase 2)

애플리케이션의 가장 기본적인 기능을 구현하고 데이터베이스 구조를 확립합니다.

### 파일 해시 기반 에피소드 식별 (AniDB 기반)

- **ED2K 해시 계산 모듈 구현**: 효율적인 스트리밍 또는 병렬 처리 방식 도입.
- **AniDB UDP API 연동**:
    - 클라이언트 식별 및 유저 계정 인증 로직 구현.
    - 세션 관리 및 재인증 로직 구현.
    - FILE, ANIME, EPISODE 등 주요 요청 종류 구현.
    - Rate Limit (2초 딜레이) 및 Ban 회피를 위한 요청 Queue 및 재시도 로직 구현.
    - UTF-8 문자열 파싱 처리.
- **파일명 기반 보조 식별 로직 구현** (선택 사항): 정규표현식 등을 이용한 파싱.
- **식별 결과 처리 및 공용 식별자 활용**: AniDB 결과(시리즈 ID, 에피소드 번호)를 다른 API 연계 키로 활용.

### 로컬 데이터베이스 스키마 설계 및 구현

- SQLite DB 초기화 및 연결 설정.
- Series, Episode, File, WatchHistory, FavoriteSeries 등 핵심 테이블 ORM 모델 정의 (SQLAlchemy).
- 각 테이블 필드 정의 (`docs/develop_report.md`의 스키마 예시 참고).
- 테이블 간 관계 (FK) 정의.
- 기본적인 CRUD (Create, Read, Update, Delete) 로직 구현.
- 성능 최적화를 위한 주요 필드 인덱스 추가 검토.

### 기본 메타데이터 수집 및 캐싱 (AniDB 중심)

- **API 응답 캐싱 로직 구현**:
    - 외부 API 응답 데이터를 로컬 DB에 저장.
    - 고유 ID를 키로 사용, 필요한 필드 또는 전체 JSON 저장.
    - 캐시 데이터 타임스탬프 기록 및 자동/수동 갱신 로직 (방영 중인 애니메이션 고려).
- **오프라인 사용 지원을 위한 기본 로직**: 캐시된 데이터 기반 정보 표시 기능 구현.
- **메타데이터 업데이트 기능**: 캐시된 데이터와 API 응답 비교 후 변경분만 갱신.

## 3. 기능 확장 - 다양한 메타데이터 연동 및 파일 정리 (Phase 3)

다양한 외부 API 연동을 통해 정보를 풍부하게 하고 파일 정리 기능을 완성합니다.

### 다양한 메타데이터 API 플러그인 연동

- **MetadataPlugin 인터페이스 설계**: `search_series`, `get_series_info`, `get_episode_info` 등 추상 메서드 정의.
- **AniDB 플러그인 구현**: MetadataPlugin 인터페이스 구현.
- **TMDB 플러그인 구현**:
    - TMDB API Key 사용 로직 구현.
    - Search API, TV Details API 연동 구현.
    - 포스터 URL, 개요, 장르, 에피소드 정보 등 수집 및 파싱.
    - 언어 설정(ko-KR 등) 활용 로직.
    - 요청 제한 및 타임슬립 처리.
- **MyAnimeList (MAL) / Jikan API 플러그인 구현**:
    - Jikan API 엔드포인트 연동 (작품 검색, 상세).
    - 평점, 순위, 인기도, 장르, 태그 등 수집.
    - Rate Limit 및 캐싱 고려. Jikan 실패 시 대체 처리 고려.
- **AniList GraphQL API 플러그인 구현** (우선순위 낮음):
    - GraphQL 쿼리 작성 및 `gql` 또는 `requests` 연동.
    - 유저 관심도, 관계 데이터, 캐릭터/성우 정보 등 수집 로직 (필요 시).
    - 분당 90회 쿼리 한도 고려.
- **메타데이터 통합 및 충돌 처리 로직 구현**:
    - 여러 소스에서 얻은 데이터 통합.
    - 우선순위 정의 (AniDB 식별, TMDB 개요/포스터, MAL/AniList 평점 등).
    - 사용자 설정에 따른 소스 신뢰도 커스터마이징 기능.
    - 여러 출처 데이터 동시 표시 기능 (선택 사항).
- **플러그인 추가 확장성 고려 설계**: 새로운 플러그인 연동 구조 확립.

### 사용자 설정에 따른 파일 정리 구현

- **기본 정리 규칙 구현**: "연도/분기/시리즈명/에피소드" 폴더 구조 생성.
- **폴더 생성 로직**: 방영 연도/분기 산출 및 폴더 생성.
- **파일명 규칙 구현**: 에피소드 번호/제목 기반 파일명 구성 (두/세 자리 포맷, 제목 포함/제외 옵션).
- **사용자 정의 파일명 패턴 커스터마이징 기능**: `%series%`, `%ep_no%`, `%title%` 등 플레이스홀더 지원.
- **관련 파일 (자막 등) 함께 이동/변경 처리 로직**.
- **이름 충돌 및 중복 처리 로직**: 번호 추가, 별도 폴더 이동, 사용자 알림 등.
- **원본 보존 옵션 구현**: 백업 또는 휴지통 이동 기능.
- **정리 작업 시뮬레이션 모드 구현**: 실제 파일 변경 전 결과 미리보기.
- **GUI 연동**: 진행 상황 표시, 결과 폴더 열기 버튼.

## 4. 사용자 편의 기능 및 확장성 확보 (Phase 4)

미디어 플레이어 연동, 시청 기록 관리, 추천 기능 등 사용자 경험을 향상시키는 기능을 구현하고 플러그인 구조를 강화합니다.

### 미디어 플레이어 연동 및 시청 기록

- **외부 플레이어 선택 기능 구현**: VLC, MPV 등 선택 및 설치 경로 지정.
- **플레이어 실행 방식 결정 및 구현**: 외부 실행 + IPC 제어 혼합 방안 우선 검토.
- **재생 상태 모니터링 로직**: 현재 재생 시간, 이벤트 (일시정지, 종료) 파악 (수동 시청 완료 체크 우선).
- **시청 기록 저장**: WatchHistory 테이블에 기록 (에피소드, 시각, 소요 시간, 완료 여부).
- **시청 진행도 표시 로직**: UI에 시청 진행률, 마지막 본 에피소드 표시.
- **플레이어 추가 기능 연동** (선택 사항): 다음 화 자동 재생, 설정 전달 등.

### 시청 기록 통계 및 분석

- **간단한 시청 통계 기능**: 총 시청 에피소드/시간, 일별/월별 패턴, 선호 장르/시리즈 등 계산 및 표시.
- **시청 기록 편집 및 삭제 기능**.
- **시청 기록 내보내기/가져오기 또는 외부 동기화** (MAL/AniList) 기능 (우선순위 낮음).
- **완주 작품 표시 기능**.
- **데이터 분석 확장 고려** (추후): 머신러닝 기반 분석.

### 즐겨찾기 시리즈 등록 및 추천 시스템

- **즐겨찾기 등록 및 관리 기능**: FavoriteSeries 테이블 활용, 별도 목록 UI.
- **추천 시스템 연동 구현**:
    - **외부 API 활용**: AniList/MAL 추천 데이터 연동 또는 공개 추천 API 활용.
    - **내부 알고리즘**: 장르/태그 기반 유사 작품 추천 구현.
- **추천 UI 구현**: 추천 목록 표시, 선정 이유 표시 (선택 사항), 피드백 기능.
- **개인화 설정**: 추천 기능 On/Off, 즐겨찾기 기준 선택.

### 플러그인 구조 강화 및 관리

- **플러그인 로딩 메커니즘 선택 및 구현**: 디렉토리 스캔 방식 우선, 엔트리 포인트 방식 고려.
- **플러그인 등록 및 설정 UI/로직 구현**: 환경설정 파일 또는 GUI에서 관리.
- **플러그인 간 의존성 관리 방안 적용**: 코어에서 흐름 제어.
- **플러그인 안정성 확보**: 예외 처리, 사용량 제한 감시, 로그 기록.

## 5. 품질 보증 및 배포 (Phase 5)

개발된 애플리케이션의 안정성을 확보하고 사용자에게 배포 및 유지보수 계획을 수립합니다.

### 테스트 전략 실행

- **유닛 테스트 작성 및 실행**: 각 모듈/함수 단위 테스트 (`pytest`, Mock, vcr.py 활용).
- **통합 테스트 작성 및 실행**: 주요 시나리오 통합 테스트 (테스트용 파일/폴더 준비, DB/폴더 구조 확인). 실제 API 연결 최소화.
- **GUI 테스트** (수동 테스트 위주, 자동화 고려).
- **성능 및 부하 테스트**: 대규모 파일/라이브러리 대상 테스트.
- **사용자 인수 테스트 (UAT)**: 실제 사용자 대상 베타 테스트 및 피드백 반영.
- **테스트 환경 구축**: Windows 환경 테스트, CI 환경 설정.

### 배포 및 유지보수 준비

- **배포 형식 결정 및 빌드**: PyInstaller를 활용한 Standalone 실행 파일 (.exe) 생성 (Single-folder 또는 One-file).
- **인스톨러 제공** (선택 사항): Inno Setup/NSIS 활용 고려.
- **업데이트 배포 전략**: 수동 업데이트 안내 (초기), 자동 업데이트 기능 고려 (향후).
- **로그 및 오류 보고 시스템 구현**: 상세 로그, 오류 리포트 생성 및 전송 기능.
- **성능 모니터링 및 최적화**: 디버그 모드, 병목 지점 분석, 필요 시 C/JIT 최적화.
- **기능 추가 및 플러그인 업데이트 대응 전략 수립**.
- **사용자 가이드 및 문서 작성**.
- **라이선스 검토 및 포함**.
- **향후 계획 고려**: 모바일/웹 연동, Cross-platform 지원 가능성 열어둠.
- **사용자 커뮤니티 운영 고려**: 피드백 수렴 및 소통 채널 마련. 