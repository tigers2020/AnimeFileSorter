# 애니메이션 파일 정리 애플리케이션 - 시스템 아키텍처

## 전체 시스템 아키텍처

AnimeFileSorter는 모듈식 아키텍처를 채택하여 확장성과 유지보수성을 높이고 있습니다. 시스템은 MVC(Model-View-Controller) 패턴을 따르며, 다음과 같은 주요 모듈로 구성됩니다.

```
AnimeFileSorter/
├── src/
│   ├── core/           # 핵심 기능 및 유틸리티
│   ├── models/         # 데이터 모델 및 데이터베이스 관리
│   ├── views/          # 사용자 인터페이스 구성요소
│   ├── controllers/    # 모델과 뷰 연결, 비즈니스 로직
│   ├── utils/          # 범용 유틸리티 함수
│   └── api/            # 외부 API 연동 모듈
├── docs/               # 프로젝트 문서
├── tests/              # 테스트 코드
└── resources/          # 리소스 파일 (이미지, 스타일 등)
```

## 모듈 구조도

```
                    +----------------+
                    |     Main       |
                    |  Application   |
                    +-------+--------+
                            |
        +-------------------+-------------------+
        |                   |                   |
+-------v-------+   +-------v-------+   +-------v-------+
|     View      |   |  Controller   |   |    Model      |
|   Components  |   |    Layer      |   |    Layer      |
+-------+-------+   +-------+-------+   +-------+-------+
        |                   |                   |
        |                   |                   |
+-------v-------+   +-------v-------+   +-------v-------+
|    UI         |<->|  Business     |<->|   Data        |
|  Components   |   |    Logic      |   |   Access      |
+---------------+   +---------------+   +---------------+
```

## 핵심 모듈 설명

### Core 모듈
- 애플리케이션의 핵심 기능 제공
- 파일 해시 계산, 메타데이터 추출 등 기본 알고리즘 포함
- 설정 관리 및 초기화 담당

### Models 모듈
- 데이터베이스 스키마 및 ORM 모델 정의
- 데이터 액세스 레이어 구현
- 영속성 관리 및 쿼리 처리

### Views 모듈
- GUI 요소 및 사용자 인터페이스 구현
- 화면 레이아웃 및 디자인 정의
- 사용자 입력 처리 및 이벤트 발생

### Controllers 모듈
- 모델과 뷰 간의 중재자 역할
- 비즈니스 로직 및 워크플로우 관리
- 사용자 요청 처리 및 결과 반환

### Utils 모듈
- 공통 유틸리티 기능 제공
- 로깅, 오류 처리, 문자열 처리 등 도우미 함수
- 범용적으로 사용되는 기능 집합

### API 모듈
- 외부 서비스 및 데이터베이스 연동
- AniDB, TheTVDB 등의 API 클라이언트 구현
- 네트워크 요청 및 응답 처리

## 데이터 저장소 구조

### SQLite 데이터베이스
- 로컬 메타데이터 저장을 위한 주 데이터베이스
- 애니메이션 파일 정보, 메타데이터, 사용자 설정 저장
- 성능 최적화된 인덱싱 및 쿼리 구조

### 파일 시스템 저장소
- 설정 파일 및 캐시 저장
- 사용자 홈 디렉토리 내 `.animefilesorter` 폴더 활용
- 백업 및 복원 기능 지원

## 주요 컴포넌트 간 인터페이스

### Controller-Model 인터페이스
- 모델 CRUD 작업을 위한 메서드 세트
- 트랜잭션 관리 및 데이터 일관성 유지
- 비동기 데이터 처리 지원

```python
# FileController와 AnimeFile 모델 간 인터페이스 예시
class FileController:
    def process_file(self, file_path: str) -> Optional[AnimeFile]:
        """파일을 처리하고 데이터베이스에 저장"""
        
    def get_file_by_hash(self, ed2k_hash: str) -> Optional[AnimeFile]:
        """ED2K 해시로 파일 검색"""
        
    def update_file_metadata(self, file_id: int, metadata: Dict[str, Any]) -> bool:
        """파일 메타데이터 업데이트"""
```

### View-Controller 인터페이스
- 사용자 액션을 컨트롤러 메서드에 매핑
- UI 업데이트를 위한 이벤트 기반 통신
- 비차단 작업 처리를 위한 신호-슬롯 메커니즘

```python
# MainWindow와 FileController 간 인터페이스 예시
class MainWindow(QMainWindow):
    def __init__(self, file_controller: FileController):
        self.file_controller = file_controller
        self.scan_button.clicked.connect(self._on_scan_clicked)
    
    def _on_scan_clicked(self):
        """스캔 버튼 클릭 시 파일 컨트롤러의 스캔 메서드 호출"""
        self.file_controller.scan_for_anime_files(self.selected_directory)
```

### Core-Controller 인터페이스
- 핵심 기능을 컨트롤러에 제공하는 유틸리티 메서드
- 설정 액세스 및 관리 인터페이스
- 공통 알고리즘 및 처리 기능

## 이벤트 기반 통신 구조

애플리케이션은 이벤트 기반 아키텍처를 채택하여 느슨한 결합과 효율적인 통신을 지원합니다:

1. **이벤트 발행-구독 모델**
   - 컴포넌트 간 직접적인 의존성 최소화
   - 비동기 작업 및 병렬 처리 지원
   - 확장 가능한 이벤트 핸들링 구조

2. **신호-슬롯 메커니즘**
   - Qt 프레임워크의 신호-슬롯 시스템 활용
   - UI 이벤트와 백엔드 처리 연결
   - 스레드 간 안전한 통신 보장

3. **메시지 큐**
   - 장시간 실행 작업을 위한 작업 대기열
   - 우선순위 기반 태스크 처리
   - 실행 상태 모니터링 및 취소 기능

## 플러그인 시스템 설계

확장성을 위한 플러그인 아키텍처는 다음과 같이 설계되었습니다:

1. **플러그인 인터페이스**
   - 표준화된 인터페이스를 통한 플러그인 통합
   - 명확한 계약을 통한 호환성 보장
   - 버전 관리 및 의존성 처리

2. **플러그인 유형**
   - 메타데이터 소스 플러그인: 외부 데이터베이스 연동
   - 파일 처리 플러그인: 특수 파일 형식 지원
   - UI 확장 플러그인: 사용자 인터페이스 확장

3. **플러그인 로딩 매커니즘**
   - 동적 플러그인 발견 및 로딩
   - 플러그인 활성화/비활성화 기능
   - 오류 격리 및 안전한 실행 환경

## 성능 및 확장성 고려사항

1. **멀티스레딩 처리**
   - 파일 해시 계산 및 대용량 처리를 위한 작업자 스레드
   - UI 응답성 유지를 위한 백그라운드 처리
   - 스레드 풀을 활용한 리소스 최적화

2. **캐싱 전략**
   - 메타데이터 캐싱으로 네트워크 요청 최소화
   - 자주 사용되는 데이터의 메모리 내 캐싱
   - 캐시 무효화 및 갱신 메커니즘

3. **비동기 I/O**
   - 파일 시스템 및 네트워크 작업의 비동기 처리
   - 이벤트 루프 기반 비차단 작업
   - 진행 상황 보고 및 취소 기능 지원